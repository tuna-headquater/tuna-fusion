apiVersion: v1
kind: ConfigMap
metadata:
  name: {{include "tuna-fusion-operator.configmapName" .}}
  labels:
    {{- include "tuna-fusion-operator.labels" . | nindent 4 }}
data:
  application.yaml: |
    server:
      port: {{.Values.app.serverPort}}
    logging:
      level:
        ai.tuna.fusion: {{.Values.app.loggingLevel}}
    javaoperatorsdk:
      reconcilers:
        agentDeploymentReconciler:
          clusterScoped: {{.Values.global.clusterScoped }}
          namespaces:
            - {{.Release.Namespace}}
            {{- range .Values.global.additionalWatchedNamespaces }}
            - {{ . }}
            {{- end }}
        agentEnvironmentReconciler:
          clusterScoped: {{.Values.global.clusterScoped }}
          namespaces:
            - {{.Release.Namespace}}
            {{- range .Values.global.additionalWatchedNamespaces }}
            - {{ . }}
            {{- end }}
        podFunctionBuildReconciler:
          clusterScoped: {{.Values.global.clusterScoped }}
          namespaces:
            - {{.Release.Namespace}}
            {{- range .Values.global.additionalWatchedNamespaces }}
            - {{ . }}
            {{- end }}
        podFunctionReconciler:
          clusterScoped: {{.Values.global.clusterScoped }}
          namespaces:
            - {{.Release.Namespace}}
            {{- range .Values.global.additionalWatchedNamespaces }}
            - {{ . }}
            {{- end }}
        podPoolReconciler:
          clusterScoped: {{.Values.global.clusterScoped }}
          namespaces:
            - {{.Release.Namespace}}
            {{- range .Values.global.additionalWatchedNamespaces }}
            - {{ . }}
            {{- end }}
    operator:
      leaderElection:
        enabled: {{default (gt (int .Values.replicaCount) 1) .Values.app.leaderElection}}
        namespace: {{.Release.Namespace}}
        identity: {{uuidv4}}
      sharedArchivePvcName: {{include "shared.archivePvcName" .}}
      executor:
        baseUrl: {{ include "shared.executorBaseUrl" . }}
